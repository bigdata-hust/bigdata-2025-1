ğŸ“‚ Spark_Batch/                                    [Dá»° ÃN YELP BIG DATA ANALYSIS]
â”‚
â”œâ”€â”€â”€ ğŸ“˜ 00_START_HERE.md â­                        [Báº®T Äáº¦U Tá»ª ÄÃ‚Y - HÆ°á»›ng dáº«n Ä‘iá»u hÆ°á»›ng]
â”‚     â””â”€ Navigation guide cho toÃ n bá»™ dá»± Ã¡n
â”‚
â”œâ”€â”€â”€ ğŸ“– DOCUMENTATION (TÃ i liá»‡u)
â”‚    â”‚
â”‚    â”œâ”€ README.md â­                               [Quick Start - Äá»ŒC Äáº¦U TIÃŠN!]
â”‚    â”‚   â””â”€ 7KB - Quick commands, test instructions, troubleshooting
â”‚    â”‚
â”‚    â”œâ”€ PROJECT_STRUCTURE.md â­                    [Cáº¥u trÃºc chi tiáº¿t - Äá»ŒC THá»¨ HAI!]
â”‚    â”‚   â””â”€ 80KB - Chi tiáº¿t 13 files, function mapping, code examples
â”‚    â”‚
â”‚    â”œâ”€ ARCHITECTURE_DIAGRAM.md â­                 [SÆ¡ Ä‘á»“ kiáº¿n trÃºc - Äá»ŒC THá»¨ BA!]
â”‚    â”‚   â””â”€ 35KB - Visual diagrams, data flow, class diagrams
â”‚    â”‚
â”‚    â”œâ”€ LOCAL_TEST_GUIDE.md â­                     [HÆ°á»›ng dáº«n test]
â”‚    â”‚   â””â”€ 17KB - Test tá»«ng feature, expected outputs
â”‚    â”‚
â”‚    â”œâ”€ IMPLEMENTATION_PLAN_PA1.md                [Káº¿ hoáº¡ch Phase 1]
â”‚    â”‚   â””â”€ Implementation roadmap & timeline
â”‚    â”‚
â”‚    â”œâ”€ QUICKSTART.md                             [Quick start (older)]
â”‚    â””â”€ README_BATCH.md                           [Batch readme (older)]
â”‚
â”œâ”€â”€â”€ ğŸ¯ ENTRY POINTS (Äiá»ƒm khá»Ÿi cháº¡y)
â”‚    â”‚
â”‚    â”œâ”€ batch_main.py                             [V1: 7 analyses cÆ¡ báº£n]
â”‚    â”‚   â”œâ”€ main() - Parse args, create pipeline
â”‚    â”‚   â”œâ”€ print_header()
â”‚    â”‚   â””â”€ print_footer()
â”‚    â”‚   ğŸ“Š 185 dÃ²ng
â”‚    â”‚   ğŸ¯ Usage: python batch_main.py --data-path ./data/
â”‚    â”‚
â”‚    â””â”€ batch_main_v2.py â­                        [V2: 9 analyses nÃ¢ng cao - RECOMMENDED]
â”‚        â”œâ”€ EnhancedYelpPipeline (káº¿ thá»«a YelpAnalysisPipeline)
â”‚        â”œâ”€ run_analysis_8() - Trending Businesses (Window Functions)
â”‚        â”œâ”€ run_analysis_9() - Category Performance Matrix (Pivot/Unpivot)
â”‚        â””â”€ run_all_analyses_v2() - Cháº¡y táº¥t cáº£ 9 analyses
â”‚        ğŸ“Š 324 dÃ²ng
â”‚        ğŸ¯ Usage: python batch_main_v2.py --data-path ./data/
â”‚
â”œâ”€â”€â”€ ğŸ”§ CORE MODULES (Module cá»‘t lÃµi)
â”‚    â”‚
â”‚    â”œâ”€ batch_configuration.py                    [Spark Config & Schemas]
â”‚    â”‚   â”œâ”€ SparkConfig
â”‚    â”‚   â”‚   â””â”€ create_spark_session() - Khá»Ÿi táº¡o Spark vá»›i config tá»‘i Æ°u
â”‚    â”‚   â”‚       â”œâ”€ Driver memory: 8GB
â”‚    â”‚   â”‚       â”œâ”€ Executor memory: 4GB
â”‚    â”‚   â”‚       â”œâ”€ Shuffle partitions: 20
â”‚    â”‚   â”‚       â””â”€ Adaptive Query Execution: enabled
â”‚    â”‚   â”œâ”€ DataSchemas
â”‚    â”‚   â”‚   â”œâ”€ business_schema() - Schema cho business.json
â”‚    â”‚   â”‚   â”œâ”€ review_schema() - Schema cho review.json
â”‚    â”‚   â”‚   â””â”€ user_schema() - Schema cho user.json
â”‚    â”‚   ğŸ“Š 127 dÃ²ng
â”‚    â”‚
â”‚    â”œâ”€ batch_load_data.py                        [Data Loader]
â”‚    â”‚   â”œâ”€ DataLoader
â”‚    â”‚   â”‚   â”œâ”€ load_business_data() - Load 150K+ businesses
â”‚    â”‚   â”‚   â”œâ”€ load_review_data() - Load 7M+ reviews
â”‚    â”‚   â”‚   â””â”€ load_user_data() - Load 2M+ users (optional)
â”‚    â”‚   ğŸ“Š 122 dÃ²ng
â”‚    â”‚   ğŸ”— Depends on: batch_configuration.py
â”‚    â”‚
â”‚    â””â”€ batch_pipeline.py                         [Pipeline Orchestrator]
â”‚        â”œâ”€ YelpAnalysisPipeline
â”‚        â”‚   â”œâ”€ load_data() - Load táº¥t cáº£ datasets
â”‚        â”‚   â”œâ”€ run_analysis_1() - Top Selling Products
â”‚        â”‚   â”œâ”€ run_analysis_2() - User Purchase Patterns
â”‚        â”‚   â”œâ”€ run_analysis_3() - Top Users by Reviews
â”‚        â”‚   â”œâ”€ run_analysis_4() - Category Trends Over Time
â”‚        â”‚   â”œâ”€ run_analysis_5() - High Rating Low Review Count
â”‚        â”‚   â”œâ”€ run_analysis_6() - Geographic Distribution
â”‚        â”‚   â”œâ”€ run_analysis_7() - Seasonal Trends
â”‚        â”‚   â”œâ”€ run_all_analyses() - Cháº¡y táº¥t cáº£ 7 analyses
â”‚        â”‚   â””â”€ save_results() - LÆ°u káº¿t quáº£ ra CSV
â”‚        ğŸ“Š 229 dÃ²ng
â”‚        ğŸ”— Depends on: batch_configuration, batch_load_data, batch_analytics
â”‚
â”œâ”€â”€â”€ ğŸ“Š ANALYTICS MODULES (Module phÃ¢n tÃ­ch)
â”‚    â”‚
â”‚    â”œâ”€ batch_analytics.py                        [7 Analyses CÆ¡ báº£n vá»›i Broadcast Join]
â”‚    â”‚   â”œâ”€ YelpAnalytics
â”‚    â”‚   â”‚   â”‚
â”‚    â”‚   â”‚   â”œâ”€ Analysis 1: top_selling_products_recent()
â”‚    â”‚   â”‚   â”‚   â”œâ”€ TÃ­nh nÄƒng: Broadcast Join âœ“
â”‚    â”‚   â”‚   â”‚   â””â”€ Output: Top businesses theo reviews gáº§n Ä‘Ã¢y
â”‚    â”‚   â”‚   â”‚
â”‚    â”‚   â”‚   â”œâ”€ Analysis 2: user_purchase_patterns()
â”‚    â”‚   â”‚   â”‚   â”œâ”€ TÃ­nh nÄƒng: Aggregation
â”‚    â”‚   â”‚   â”‚   â””â”€ Output: PhÃ¢n tÃ­ch hÃ nh vi user
â”‚    â”‚   â”‚   â”‚
â”‚    â”‚   â”‚   â”œâ”€ Analysis 3: top_users_by_reviews()
â”‚    â”‚   â”‚   â”‚   â”œâ”€ TÃ­nh nÄƒng: Broadcast Join âœ“
â”‚    â”‚   â”‚   â”‚   â””â”€ Output: Top users theo sá»‘ lÆ°á»£ng reviews
â”‚    â”‚   â”‚   â”‚
â”‚    â”‚   â”‚   â”œâ”€ Analysis 4: category_trends_over_time()
â”‚    â”‚   â”‚   â”‚   â”œâ”€ TÃ­nh nÄƒng: Broadcast Join âœ“
â”‚    â”‚   â”‚   â”‚   â””â”€ Output: Xu hÆ°á»›ng theo categories
â”‚    â”‚   â”‚   â”‚
â”‚    â”‚   â”‚   â”œâ”€ Analysis 5: high_rating_low_review_businesses()
â”‚    â”‚   â”‚   â”‚   â”œâ”€ TÃ­nh nÄƒng: Filter & Aggregation
â”‚    â”‚   â”‚   â”‚   â””â”€ Output: Businesses Ã­t review nhÆ°ng rating cao
â”‚    â”‚   â”‚   â”‚
â”‚    â”‚   â”‚   â”œâ”€ Analysis 6: geographic_distribution()
â”‚    â”‚   â”‚   â”‚   â”œâ”€ TÃ­nh nÄƒng: Broadcast Join âœ“
â”‚    â”‚   â”‚   â”‚   â””â”€ Output: PhÃ¢n bá»‘ theo Ä‘á»‹a lÃ½
â”‚    â”‚   â”‚   â”‚
â”‚    â”‚   â”‚   â””â”€ Analysis 7: seasonal_trends()
â”‚    â”‚   â”‚       â”œâ”€ TÃ­nh nÄƒng: Time-based Analysis
â”‚    â”‚   â”‚       â””â”€ Output: Xu hÆ°á»›ng theo mÃ¹a
â”‚    â”‚   â”‚
â”‚    â”‚   ğŸ“Š 335 dÃ²ng
â”‚    â”‚   âš¡ Optimizations: Broadcast Join (4 analyses), Caching, Salted Aggregation
â”‚    â”‚
â”‚    â””â”€ batch_analytics_advanced.py â­             [2 Analyses NÃ¢ng cao]
â”‚        â”œâ”€ AdvancedYelpAnalytics
â”‚        â”‚   â”‚
â”‚        â”‚   â”œâ”€ Analysis 8: trending_businesses()
â”‚        â”‚   â”‚   â”œâ”€ TÃ­nh nÄƒng: Window Functions âœ“
â”‚        â”‚   â”‚   â”‚   â”œâ”€ lag() - So sÃ¡nh vá»›i tuáº§n trÆ°á»›c
â”‚        â”‚   â”‚   â”‚   â”œâ”€ lead() - NhÃ¬n trÆ°á»›c tuáº§n sau
â”‚        â”‚   â”‚   â”‚   â”œâ”€ avg() over window - Moving average 4 tuáº§n
â”‚        â”‚   â”‚   â”‚   â”œâ”€ dense_rank() - Ranking businesses
â”‚        â”‚   â”‚   â”‚   â””â”€ rowsBetween(-3, 0) - Sliding window
â”‚        â”‚   â”‚   â””â”€ Output: Top businesses trending vá»›i growth rate
â”‚        â”‚   â”‚
â”‚        â”‚   â””â”€ Analysis 9: category_performance_matrix()
â”‚        â”‚       â”œâ”€ TÃ­nh nÄƒng: Pivot/Unpivot Operations âœ“
â”‚        â”‚       â”‚   â”œâ”€ pivot() - Long â†’ Wide format
â”‚        â”‚       â”‚   â”œâ”€ stack() - Wide â†’ Long format (unpivot)
â”‚        â”‚       â”‚   â””â”€ Cross-tabulation analysis
â”‚        â”‚       â””â”€ Output: Ma tráº­n categories Ã— cities
â”‚        â”‚
â”‚        ğŸ“Š 473 dÃ²ng
â”‚        ğŸ”— Depends on: batch_udf.py
â”‚
â”œâ”€â”€â”€ ğŸ¯ UDF LIBRARY (ThÆ° viá»‡n hÃ m tÃ¹y chá»‰nh)
â”‚    â”‚
â”‚    â””â”€ batch_udf.py â­                            [7 UDFs - Regular & Pandas]
â”‚        â”‚
â”‚        â”œâ”€â”€â”€ ğŸ“Œ REGULAR UDFs (Row-by-row processing)
â”‚        â”‚    â”‚
â”‚        â”‚    â”œâ”€ categorize_rating(stars)
â”‚        â”‚    â”‚   â”œâ”€ Input: int (1-5 stars)
â”‚        â”‚    â”‚   â””â”€ Output: string ("Excellent" / "Good" / "Average" / "Poor")
â”‚        â”‚    â”‚
â”‚        â”‚    â”œâ”€ is_weekend(date)
â”‚        â”‚    â”‚   â”œâ”€ Input: datetime
â”‚        â”‚    â”‚   â””â”€ Output: boolean (True if Saturday/Sunday)
â”‚        â”‚    â”‚
â”‚        â”‚    â””â”€ extract_city_state(address)
â”‚        â”‚        â”œâ”€ Input: string (full address)
â”‚        â”‚        â””â”€ Output: string ("City, State")
â”‚        â”‚
â”‚        â””â”€â”€â”€ âš¡ PANDAS UDFs (Vectorized - 10-100x faster!)
â”‚             â”‚
â”‚             â”œâ”€ sentiment_score(text)
â”‚             â”‚   â”œâ”€ Input: pd.Series (review texts)
â”‚             â”‚   â””â”€ Output: pd.Series (float 0.0-1.0, 0=negative, 1=positive)
â”‚             â”‚
â”‚             â”œâ”€ extract_keywords(text)
â”‚             â”‚   â”œâ”€ Input: pd.Series (review texts)
â”‚             â”‚   â””â”€ Output: pd.Series (top 3 keywords as string)
â”‚             â”‚
â”‚             â”œâ”€ text_length_normalized(text)
â”‚             â”‚   â”œâ”€ Input: pd.Series (review texts)
â”‚             â”‚   â””â”€ Output: pd.Series (normalized length 0.0-1.0)
â”‚             â”‚
â”‚             â””â”€ extract_hashtags(text)
â”‚                 â”œâ”€ Input: pd.Series (review texts)
â”‚                 â””â”€ Output: pd.Series (comma-separated hashtags)
â”‚        â”‚
â”‚        ğŸ“Š 443 dÃ²ng
â”‚        âš¡ Performance: Pandas UDF 10-100x nhanh hÆ¡n Regular UDF
â”‚
â”œâ”€â”€â”€ ğŸ§ª TESTING (Kiá»ƒm thá»­)
â”‚    â”‚
â”‚    â””â”€ test_local_features.py â­                  [Test Suite cho 4 tÃ­nh nÄƒng nÃ¢ng cao]
â”‚        â”œâ”€ FeatureTester
â”‚        â”‚   â”‚
â”‚        â”‚   â”œâ”€ test_udfs()
â”‚        â”‚   â”‚   â”œâ”€ Test 7 UDFs (3 Regular + 4 Pandas)
â”‚        â”‚   â”‚   â””â”€ So sÃ¡nh performance Regular vs Pandas
â”‚        â”‚   â”‚
â”‚        â”‚   â”œâ”€ test_window_functions()
â”‚        â”‚   â”‚   â”œâ”€ Test Analysis 8
â”‚        â”‚   â”‚   â””â”€ Verify lag/lead/rank/avg operations
â”‚        â”‚   â”‚
â”‚        â”‚   â”œâ”€ test_pivot_unpivot()
â”‚        â”‚   â”‚   â”œâ”€ Test Analysis 9
â”‚        â”‚   â”‚   â””â”€ Validate pivot/unpivot transformations
â”‚        â”‚   â”‚
â”‚        â”‚   â””â”€ test_broadcast_join()
â”‚        â”‚       â”œâ”€ Check physical plan
â”‚        â”‚       â””â”€ Verify BroadcastHashJoin in explain()
â”‚        â”‚
â”‚        ğŸ“Š 355 dÃ²ng
â”‚        ğŸ¯ Usage: python test_local_features.py --test [udf|window|pivot|broadcast|all]
â”‚
â”œâ”€â”€â”€ ğŸ› ï¸ UTILITIES (Tiá»‡n Ã­ch)
â”‚    â”‚
â”‚    â””â”€ create_sample_data.py                     [Táº¡o dá»¯ liá»‡u máº«u]
â”‚        â”œâ”€ create_sample_business_data() - 100 businesses
â”‚        â”œâ”€ create_sample_review_data() - 1000 reviews
â”‚        â””â”€ Output: data/sample_business.json, data/sample_review.json
â”‚        ğŸ“Š 119 dÃ²ng
â”‚        ğŸ¯ Usage: python create_sample_data.py
â”‚
â””â”€â”€â”€ ğŸ“ DATA (Dá»¯ liá»‡u)
     â”‚
     â”œâ”€ business.json                             [150,346 businesses]
     â”œâ”€ review.json                               [6,990,280 reviews]
     â””â”€ user.json                                 [1,987,897 users]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š STATISTICS - THá»NG KÃŠ Dá»° ÃN

â”œâ”€ Tá»•ng dÃ²ng code Python:     2,712 lines
â”œâ”€ Sá»‘ Python files:            13 files
â”œâ”€ Sá»‘ documentation files:     7 files (~160KB)
â”œâ”€ Sá»‘ analyses:                9 (7 basic + 2 advanced)
â”œâ”€ Sá»‘ UDFs:                    7 (3 Regular + 4 Pandas)
â”œâ”€ Spark features:             15+ features
â”œâ”€ Test coverage:              4 feature tests
â””â”€ Skill coverage:             42% â†’ 64% (+22%)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ QUICK COMMANDS - Lá»†NH NHANH

# 1. Cháº¡y pipeline Ä‘áº§y Ä‘á»§ (9 analyses)
python3 batch_main_v2.py --data-path ./data/

# 2. Cháº¡y pipeline cÆ¡ báº£n (7 analyses)
python3 batch_main.py --data-path ./data/

# 3. Test táº¥t cáº£ tÃ­nh nÄƒng nÃ¢ng cao
python3 test_local_features.py --test all

# 4. Test tá»«ng feature riÃªng
python3 test_local_features.py --test udf
python3 test_local_features.py --test window
python3 test_local_features.py --test pivot
python3 test_local_features.py --test broadcast

# 5. Táº¡o dá»¯ liá»‡u máº«u
python3 create_sample_data.py

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ—ºï¸ DEPENDENCY GRAPH - QUAN Há»† PHá»¤ THUá»˜C

                    batch_main_v2.py (V2 Entry)
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚             â”‚             â”‚
              â–¼             â–¼             â–¼
      batch_pipeline    batch_analytics_  (test files)
            .py         advanced.py
              â”‚             â”‚
        â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”      â”‚
        â”‚     â”‚     â”‚      â”‚
        â–¼     â–¼     â–¼      â–¼
      cfg   ldr   anl   batch_udf.py
        â”‚
        â–¼
    PySpark

    Legend:
      cfg = batch_configuration.py
      ldr = batch_load_data.py
      anl = batch_analytics.py

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“š DOCUMENTATION ROADMAP - Lá»˜ TRÃŒNH Äá»ŒC

NgÆ°á»i má»›i (ChÆ°a biáº¿t gÃ¬):
  1. 00_START_HERE.md (2 min)         â†’ Overview & navigation
  2. README.md (5 min)                â†’ Quick start & commands
  3. ARCHITECTURE_DIAGRAM.md (15 min) â†’ Visual diagrams
  4. PROJECT_STRUCTURE.md (30 min)    â†’ Chi tiáº¿t tá»«ng module
  5. Hands-on: Run tests & pipeline

Developer (Muá»‘n add features):
  1. PROJECT_STRUCTURE.md             â†’ TÃ¬m module cáº§n sá»­a
  2. Function Mapping section         â†’ Biáº¿t hÃ m nÃ o á»Ÿ Ä‘Ã¢u
  3. Dependency Graph                 â†’ Hiá»ƒu quan há»‡ modules
  4. Add code theo pattern            â†’ Maintain consistency

Reviewer (Review code):
  1. ARCHITECTURE_DIAGRAM.md          â†’ High-level design
  2. PROJECT_STRUCTURE.md             â†’ Implementation details
  3. LOCAL_TEST_GUIDE.md              â†’ Test coverage

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â­ = Files/Features má»›i trong Phase 1 (Advanced Features)
âœ“ = Feature Ä‘Ã£ Ä‘Æ°á»£c implement

Last Updated: 2025-12-16
Version: 2.0 (Advanced Features)
Branch: claude/review-project-structure-pfDJE
